% Youpi paper for ADASS 2009 @ Sapporo, Japan
% F4.monnerville.tex

\documentclass[11pt,twoside]{article}  % Leave intact
\usepackage{asp2006}
\usepackage{adassconf}

\begin{document}   % Leave intact

%-----------------------------------------------------------------------
%			    Paper ID Code
%-----------------------------------------------------------------------
% Enter the proper paper identification code.  The ID code for your paper 
% is the session number associated with your presentation as published 
% in the official conference proceedings.  You can find this number by 
% locating your abstract in the printed proceedings that you received 
% at the meeting, or on-line at the conference web site.
%
% This identifier will not appear in your paper; however, it allows different
% papers in the proceedings to cross-reference each other.  Note that
% you should only have one \paperID, and it should not include a
% trailing period.

\paperID{F4}

%-----------------------------------------------------------------------
%		            Paper Title 
%-----------------------------------------------------------------------
% Enter the title of the paper.

\title{Youpi, a Web-based Astronomical Image Processing Pipeline}
       
%-----------------------------------------------------------------------
%          Short Title & Author list for page headers
%-----------------------------------------------------------------------
% Please supply the author list and the title (abbreviated if necessary) as 
% arguments to \markboth.
%
% The author last names for the page header must appear in one of 
% these formats:
%
% EXAMPLES:
%     LASTNAME
%     LASTNAME1 and LASTNAME2
%     LASTNAME1, LASTNAME2, and LASTNAME3
%     LASTNAME et al.
%
% Use the "et al." form in the case of four or more authors.
%
% If the title is too long to fit in the header, shorten it: 
%
% EXAMPLE: change
%    Rapid Development for Distributed Computing, with Implications for the Virtual Observatory
% to:
%    Rapid Development for Distributed Computing

\markboth{Monnerville and S\'emah}{Youpi, a Web-based Astronomical Image Processing Pipeline}

%-----------------------------------------------------------------------
%		          Authors of Paper
%-----------------------------------------------------------------------
% Enter the authors followed by their affiliations.  The \author and
% \affil commands may appear multiple times as necessary.  List each
% author by giving the first name or initials first followed by the
% last name. Do not include street addresses and postal codes, but 
% do include the country name or abbreviation. 
%
% If the list of authors is lengthy and there are several institutional 
% affiliations, you can save space by using the \altaffilmark and \altaffiltext 
% commands in place of the \affil command.

\author{M.\ Monnerville \& G.\ S\'emah}
\affil{Terapix, Institut d'Astrophysique de Paris, CNRS, University of Pierre et Marie Curie, UMR 7095, Paris, F-75014, France}

%-----------------------------------------------------------------------
%			 Contact Information
%-----------------------------------------------------------------------
% This information will not appear in the paper but will be used by
% the editors in case you need to be contacted concerning your
% submission.  Enter your name as the contact along with your email
% address.

\contact{Mathias Monnerville}
\email{monnerville@iap.fr}

%-----------------------------------------------------------------------
%		      Author Index Specification
%-----------------------------------------------------------------------
% Specify how each author name should appear in the author index.  The 
% \paindex{ } should be used to indicate the primary author, and the
% \aindex for all other co-authors.  You MUST use the following syntax: 
%
%    \aindex{LASTNAME, F.~M.}
% 
% where F is the first initial and M is the second initial (if used). Please 
% ensure that there are no extraneous spaces anywhere within the command 
% argument. This guarantees that authors that appear in multiple papers
% will appear only once in the author index. Authors must be listed in the order
% of the \paindex and \aindex commmands.

%\paindex{Djorgovski, S.}
%\aindex{King, I.~R.}
%\aindex{Biemesderfer, C.~D.}

\paindex{Monnerville, M.}
\aindex{S\'emah, G.}

%-----------------------------------------------------------------------
%			Subject Index keywords
%-----------------------------------------------------------------------
% Enter up to 6 keywords that are relevant to the topic of your paper.  These 
% will NOT be printed as part of your paper; however, they will guide the creation 
% of the subject index for the proceedings.  Please use entries from the
% standard list where possible, which can be found in the index for the 
% ADASS XVI proceedings. Separate topics from sub-topics with an exclamation 
% point (!). 

\keywords{astronomy!pipeline clusters condor}

% We reset the footnote counter for the hyperlink since it does not
% appear to recognize the previous 3 footnotes generated from the
% altaffilmarks.  

\setcounter{footnote}{3}

%-----------------------------------------------------------------------
%			       Abstract
%-----------------------------------------------------------------------
% Type abstract in the space below.  Consult the User Guide and Latex
% Information file for a list of supported macros (e.g. for typesetting 
% special symbols). Do not leave a blank line between \begin{abstract} 
% and the start of your text.

\begin{abstract} 
Youpi\footnote{http://youpi.terapix.fr/} stands for ``YOUpi is your processing PIpeline''. 
It is a portable, easy to use web application providing high level functionalities to perform 
data reduction on scientific FITS images. It is built on top of open source processing tools 
that are released to the community by Terapix, in order to organize your data on a computer 
cluster, to manage your processing jobs in real time and to facilitate teamwork by allowing 
fine-grain sharing of results and data. On the server side, Youpi is written in the \emph{Python}
programming language and uses the \emph{Django}\footnote{http://www.djangoproject.com/} web 
framework. On the client side, Ajax techniques are used along with the \emph{Prototype} and 
\emph{script.aculo.us} Javascript librairies\footnote{http://www.prototypejs.org/, http://script.aculo.us/}.
\end{abstract}

%-----------------------------------------------------------------------
%			      Main Body
%-----------------------------------------------------------------------
% Place the text for the main body of the paper here.  You should use
% the \section command to label the various sections; use of
% \subsection is optional.  Significant words in section titles should
% be capitalized.  Sections and subsections will be numbered
% automatically. 

\section{Introduction}

Youpi is a new generic and versatile web-based pipeline that is suitable to handle both large 
surveys, like the CFHTLS (Goranova et al 2009), and smaller, less-well organized sets of 
observations. 

Youpi is designed to run and supervise data management by keeping track of all data locations 
and parameters involved during the pipeline's life cycle. It starts at the onset of the FITS 
images ingestion into the database and keeps running until the final processing results are 
produced.

\section{Handling FITS Data Ingestion}

Ingesting images is the main entry point for Youpi users. By selecting -- with a selector widget -- 
one or several data paths that locate its FITS images (available either locally or on the network 
by using network shares such as NFS), the user notifies Youpi to read their headers and ingest 
the relevant information in the database. When the ingestion is completed, Youpi reports the 
details of the ingestion to the user by email. The ingestion can be carried once, so any image 
ingested can then be used at any time for later processing. Youpi provides effective tools 
(see section \ref{sec:ims}) to define selection criteria and set valid requests to it. 

\section{Data Processing}

Youpi is a high-level tool acting as a wrapper for freely available, low-level software packages 
released by Terapix: it currently supports \emph{QualityFITS}, the image 
quality assessment software; the astrometric and photometric calibration tool, \emph{SCAMP} 
(Bertin 2006); the image resampling and stacking software, \emph{SWarp}; and the source extraction 
and catalogue production tool, \emph{SExtractor}.

All of these processings are internally available as plugins. Some of them can be disabled 
in order to meet any specific or fragmented processing sequence requested by the user. This 
plugin architecture is very modular and versatile. A comprehensive documentation provides user 
instructions to write custom plugins that would extend Youpi's default processing capabilities.

Youpi manages data access rights and protections by implementing a Unix-like file permission system. 
Each user has a personnal password protected account, where its data sets and results can have 
user-defined permissions for the owner, a group and the rest of the world. Permissions can be 
modified according to user wishes to share images, data products or even pipeline configuration 
files.

\section{Data Management}

Being able to assist the astronomer in data management and data sharing has been an important 
goal since the beginning of the project. As such, the Youpi user interface has many widgets 
and tools that make data selection and organisation, or the management and set up of configuration 
and results files easy.

\paragraph{The Data Path Selector}

Whichever processing plugin selected, an embedded path selector can select and save data paths 
in real time from the user's Internet browser. For example, to derive the astrometric and photometric 
calibrations of a bunch of images using the \emph{SCAMP} plugin, the user must provide a path to 
external \emph{.ahead} files. The path selector widget can browse the user's local -- and remote, 
if network mounts are used -- filesystems, and save those directories for later reuse.

\paragraph{The Image Selector}\label{sec:ims}

The image selector (Fig. \ref{fig:ims}) is a selection tool to set up image lists based on previously 
ingested images. Multiple search criteria can be combined together, including \emph{RUNID}, \emph{channel}, 
\emph{grade} (since Youpi provides an integrated interface for image quality assessment).

Once a selection of images is completed, basic editing commands can be used to save the current 
selection. Saved selections can also be deleted or merged with any other. In order to increase the 
image selector's flexibility, options have been added to upload a plain text file describing the 
selection (one image name and optional checksum per line) or to batch-import all text files within 
a directory. These two features allow Youpi to create and save selections on-the-fly rather than 
manually. This can be interesting if you are working on a large survey involving lots of images 
because the user can then decide to prepare all its selections of images before processing them.

\begin{figure}[h]
\epsscale{1}
\plotone{F4.monnerville.fig1.eps}
\caption{A selection of 1450 images is built by retreiving all images from the 
\emph{CFHTLS-T0006-W3\_Scamp} saved selection.}\label{fig:ims}
\end{figure}

\paragraph{Organizing Data With Tags}

A tag is a non-hierarchical keyword that can be assigned to a piece of information. Youpi allows 
tagging ingested images in order to add some kind of metadata useful for item description. Tagged 
images can later be searched by tag name using the image selector. Applying tags on a selection of 
images is easy (Fig. \ref{fig:tags}): a user just creates a new tag -- or use an existing one -- and 
drag and drop it over a dedicated drop zone to mark or unmark the current selection. The number 
of tags that can be applied to an image is unlimited in practice.

\begin{figure}[h]
\epsscale{1}
\plotone{F4.monnerville.fig2.eps}
\caption{Dragging the \emph{field-D4} tag over a selection of images.}\label{fig:tags}
\end{figure}

\paragraph{The Processing Cart}

Before running any processing with Youpi, all input data, configuration parameters and processing 
tasks are first bundled together in one processing cart item. The processing cart acts like shopping 
carts on commercial websites. This is a convenient place for sharing processings among users -- 
because processing items can be saved for later use and loaded back to the processing cart at 
anytime by others -- or for setting runtime options before submitting the job on the cluster.

\section{Cluster Computing With Condor}

Youpi heavily relies on \emph{Condor}\footnote{http://www.cs.wisc.edu/condor/} for running processings. Condor is an open source 
high-throughput computing software framework for distributed parallelization of computationally 
intensive tasks. It is therefore well suited for working with clusters of computers.

Ingestions as well as processing cart items are submitted as Condor jobs. Youpi handles all 
input parameters and generates a \emph{Condor submission file} -- a plain text file specifying 
job requirements, environment and complete command line -- ready to be executed on the Condor cluster.

Depending on requirements, it may be useful to target a specific subset of cluster 
nodes. Youpi has a page dedicated to Condor requirements setup. From this page, users can define 
custom policies or selections. Custom policies are \emph{dynamic rules}: several criteria can be 
defined using regular expressions. Dynamic rules will only be computed just before job submission 
from the processing cart to the cluster. In contrast, custom selections are made of \emph{static nodes} 
selected among the available cluster nodes displayed on the screen.

Once jobs have been submitted to the Condor cluster, they can be monitored directly from within 
your browser on Youpi's \emph{Active Monitoring} page. Important information such as job's 
description, remote host, run time, job's owner and current status are displayed and refreshed 
in real time, without reloading the page.

\section{Summary}

Youpi is a versatile pipeline since it can be used on a single host -- a desktop computer or even 
a laptop -- or on larger installations such as computer clusters. It currently supports images 
from the CFHT-MegaCam, CFHT-WIRCam and ESO-VISTA-VIRCAM instruments, and we plan to support more 
in the future. 

Youpi is actively maintained at Terapix\footnote{http://terapix.iap.fr/} and published under an 
open source license. It has first been released to the community on September 2009.

\acknowledgments

We are grateful to Y.\ Goranova, P.\ Hudelot, F.\ Magnard, H.\ McCracken, Y.\ Mellier and 
M.\ Schultheis for their active support. We would also like to thank Y.\ Kakazu for her Japanese
translation of Youpi's abstract.

\begin{references}

\reference Bertin~E., 2006, ASPC, 351, 112
\reference Bertin~E., Arnouts~S., 1996, A\&AS 317,393
\reference Bertin et al. 2002, ASP Conference Series, 281, 228
\reference Goranova, Y. Hudelot, P. Magnard, F., McCracken, H.,
 Mellier, Y., Monnerville, M., Schultheis, M., S\'emah, G., Cuillandre, J.-C., Aussel, H., 2009, {\it The CFHTLS T0006 Release},
 {\tt http://terapix.iap.fr/cplt/T0006/T0006-doc.pdf}\\
    
\end{references}

% Do not place any material after the references section

\end{document}  % Leave intact
