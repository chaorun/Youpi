<HEAD></HEAD>
{% extends "base_site.html" %}
{% load i18n %}


{% block extrahead %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="/media/themes/{{ user.get_profile.guistyle }}/css/menu.css"></script>
<script language="javascript" type="text/javascript" src="/media/js/javascript.js"></script>
<script type="text/javascript" src="/media/js/xhr.js"></script>
<script type="text/javascript" src="/media/js/common.js"></script>
<!-- Menu handling -->
<script type="text/javascript" src="/media/js/menu.js"></script>
<script type="text/javascript" src="/media/js/3rdParty/progressbar/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/media/js/3rdParty/progressbar/js/bramus/jsProgressBarHandler.js"></script>
<script type="text/javascript" src="/media/js/3rdParty/scriptaculous/prototype.js"></script>
<script type="text/javascript" src="/media/js/3rdParty/scriptaculous/scriptaculous.js"></script>
<script type="text/javascript" src="/media/js/homeindex.js"></script>


<script type="text/javascript" src="/media/js/sqlform.js"></script>
<script type="text/javascript">
var guistyle = '{{ user.get_profile.guistyle }}';

function  setup(param) {

	var post = '';

	var value = $F(param + '_input');

	if (param == 'create_survey') {
		post += '&Survey=' + value;
		}

	else if (param == 'create_instrument') { 
		
		var survey = $F('select_survey_list');
		post += '&Survey=' + survey + '&Instrument=' + value;
		}
	
	else if(param == 'create_release') {
		var survey = $F('select_survey_list');
		var instrument = $F('select_instrument_list');
		post +=  '&Survey=' + survey + '&Instrument=' + instrument + '&Release=' + value;
		}


    var xhr = new HttpRequest(
            null,
            null,   
            // Custom handler for results
            function(resp) {

				var log = new Logger(param + '_log');
				log.clear();
				if (resp['Error'].length) {
					log.msg_error(resp['Error']);
					return;
				}
				if (resp['Warning'].length) {
					log.msg_warning(resp['Warning']);
					return;
				}
				else {
					log.msg_ok('OK : '+ param + ' saved...');
					if (param == 'create_survey') {
						$('create_instrument').show()
						var select = $('select_survey_list');
						var option = document.createElement('option');
						option.update(value);
						select.appendChild(option);
						}
					else if (param == 'create_instrument') {
						$('create_release').show();
						var select = $('select_instrument_list');
						option = document.createElement('option');
						option.update(value);
						select.appendChild(option);
					}
					else if (param == 'create_release') {
						var select = $('select_release_list');
						option = document.createElement('option');
						option.update(value);
						select.appendChild(option);
					}
				}
			}
    );

    post += '&Param=' + param + '&Value=' + value;
    xhr.send('/youpi/newindex/', post);
}


function kselect(param) {
	
	var post = '';
	if (param == 'select_survey_list') {
		var name = $F('select_survey_list');
		}
	else if (param == 'select_instrument_list') {
			var name = $F('select_instrument_list');
			}
	else if (param == 'select_release_list') {
			var name = $F('select_release_list');
			}

    var xhr = new HttpRequest(
            null,
            null,   
            // Custom handler for results
            function(resp) {

				var log = new Logger(param + '_log');
				log.clear();
				if (resp['Error'].length) {
					log.msg_error(resp['Error']);
					return;
				}
				if (resp['Warning'].length) {
					log.msg_warning(resp['Warning']);
					return;
				}
				else {
					if (param == 'select_survey_list') {
						list_instrument = resp['list_instrument'];
						var select = $('select_instrument_list');
						var chil = select.childElements();
						chil.each(function(node){node.remove();});
						$('or2').show();
						$('select_instrument').show();
						$('create_instrument').show();
						$('instrument_text').update('Add instrument for survey : <B> ' + name + '</B>');
						for (var i = 0 ; i < list_instrument.length ; i++) {
							var option = document.createElement('option');
							option.update(list_instrument[i]);
							select.appendChild(option);
							}
					}
					if (param == 'select_instrument_list') {
						list_release = resp['list_release'];
						var select = $('select_release_list');
						var chil = select.childElements();
						chil.each(function(node){node.remove();});
						$('or3').show();
						$('select_release').show();
						$('create_release').show();
						$('release_text').update('Add release for instrument : <B> ' + name + '</B>');
						for (var i = 0 ; i < list_release.length ; i++) {
							var option = document.createElement('option');
							option.update(list_release[i]);
							select.appendChild(option);
							}

					}
					if (param == 'select_release_list') {
					alert(param);
					}

				}
			}
    );
    post += '&Param=' + param + '&Value=' + name;
    xhr.send('/youpi/newindex/', post);
}

</script>
{% endblock %}

{% block stylesheet %}/media/themes/{{ user.get_profile.guistyle }}/css/dashboard.css{% endblock %}
{% block coltype %}colMS{% endblock %}
{% block bodyclass %}dashboard{% endblock %}

{% block content %}
	<div id="pre_submenu">
		<ul class="smart_tabnav_sub" id="tabnav2">
			<li class="enabled"><a href="#" id="link_global" onclick="swap_display(this.id, 'menuitem_sub_0', 'tabnav2', 'menuitem_');">Global Informations</a></li>
		</ul>
	</div>
	<div id="menuitem_sub_0" style="margin-top: 10px;" align="center">
		<div align="center" class="homepage">
			<div>
				<div id="create_survey">
					Add survey :
					<input type="text" size="20" id="create_survey_input"></input>
					<input type="button" value="add!" id="add_survey_button" onclick="setup(this.parentNode.id);"></input>
					<div id="create_survey_log"></div>
				</div>
				<div id="or1">or</div>

				<div id="select_survey">
				choose survey from list :	
					<select  id="select_survey_list">
						<option> -- </option>
					{% for i in list_survey %}
						<option> {{ i }} </option>
					{% endfor %}
					</select>
					<input type="button" value="Use it!" id="choose_survey" onclick="kselect('select_survey_list');"></input>
					<div id="select_survey_list_log"></div>
				</div>
			</div>
			<HR width="30%" size="2" align="center">
			<div>
				<div id="create_instrument">
					<div id="instrument_text"></div>
					<input type="text" size="20" id="create_instrument_input"></input>
					<input type="button" value="add!" id="add_instrument_button" onclick="setup(this.parentNode.id);"></input>
					<div id="create_instrument_log"></div>
				</div>

				<div id = "or2">or</div>

				<div id="select_instrument">
				choose instrument from list :
					<select  id="select_instrument_list">
						<option> -- </option>
					</select>
					<input type="button" value="Use it!" id="choose_instrument" onclick="kselect('select_instrument_list');"></input>
					<div id="select_instrument_list_log"></div>
				</div>
			</div>
			<HR width="30%" size="2" align="center">
			<div>
				<div id="create_release">
					<div id="release_text"></div>
					<input type="text" size="20" id="create_release_input"></input>
					<input type="button" value="add!" id="add_release_button" onclick="setup(this.parentNode.id);"></input>
					<div id="create_release_log"></div>
				</div>

				<div id = "or3">or</div>

				<div id="select_release">
				choose release from list :
					<select  id="select_release_list">
						<option> -- </option>
					</select>
					<input type="button" value="Use it!" id="choose_release" onclick="kselect('select_release_list');"></input>
					<div id="select_release_list_log"></div>
				</div>
			</div>
			<HR width="30%" size="2" align="center">
		</div>
	</div>
	
{% endblock %}
	
</body>
<script>
//Hiding field by id
$('create_instrument').hide();
$('or2').hide();
$('select_instrument').hide();
$('create_release').hide();
$('or3').hide();
$('select_release').hide();
</script>
