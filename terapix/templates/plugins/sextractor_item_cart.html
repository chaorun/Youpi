{# Item cart Sextractor template #}

<table class="cleantd">
	<tr>
		<td style="width: 100%; padding: 3px">
			<div id="{{ plugin.id }}_{{ forloop.counter0 }}_selections_div"></div>
			<table class="plugin_small">
				<script type="text/javascript">
				{% ifequal data.userData.dualMode 1 %}
						{{ plugin.id }}.displayImageCount('[[1]]', '{{ plugin.id }}_{{ forloop.counter0 }}_selections_div');
				{% else %}
					{{ plugin.id }}.displayImageCount('{{ data.userData.idList }}', '{{ plugin.id }}_{{ forloop.counter0 }}_selections_div');
				{% endifequal %}
				</script>
				{% ifequal data.userData.dualMode 1 %}
				<tr>
						<td><span class="regLetter">Dual Image Mode:</span></td>
						<td> 1 image + 1 image for measurements</td>
				</tr>
				{% endifequal %}
				{% if data.userData.flagPath %}
				<tr>
					<td><span class="regLetter">Flag:</span></td>
					<td>{{ data.userData.flagPath }}</td>
				</tr>
				{% endif %}
				{% if data.userData.weightPath %}
				<tr>
					<td><span class="regLetter">Weight:</span></td>
					<td>{{ data.userData.weightPath }}</td>
				</tr>
				{% endif %}

				{% if data.userData.psfPath %}
				<tr>
					<td><span class="regLetter">Psf:</span></td>
					<td>{{ data.userData.psfPath }}</td>
				</tr>
				{% endif %}

				{% ifequal data.userData.dualMode 1 %}
					{% if data.userData.dualWeightPath %}
						<tr>
							<td><span class="regLetter">Weight for 2nd image:</span></td>
							<td>{{ data.userData.dualWeightPath }}</td>
						</tr>
						{% endif %}
					{% if data.userData.dualFlagPath %}
						<tr>
							<td><span class="regLetter">Flag for 2nd image:</span></td>
							<td>{{ data.userData.dualFlagPath }}</td>
						</tr>
					{% endif %}
				{% endifequal %}

				<tr>
					<td><span class="confLetter">Config:</span></td>
					<td>{{ data.userData.config }}</td>
				</tr>
				<tr>
					<td><span class="confLetter">Results output dir:</span></td>
					<td>{{ data.userData.resultsOutputDir }}</td>
				</tr>
			</table>
			<div id="{{ plugin.id }}_images_div_{{ forloop.counter0 }}" style="display: none;"></div>
		</td>
		<td style="text-align: center; vertical-align: middle">
			<div class="submitItem">
				<p><img src="/media/themes/{{ user.get_profile.guistyle }}/img/48x48/{{ plugin.id }}.png" style="vertical-align:middle"/></p>
				<p><img id="{{ plugin.id }}_{{ forloop.counter0 }}_run" src="/media/themes/{{ user.get_profile.guistyle }}/img/misc/run.gif" title="Submit processing to cluster"/> 
				</p>
			</div>
			<div>or</div>
			<img id="{{ plugin.id }}_{{ forloop.counter0 }}_save" src="/media/themes/{{ user.get_profile.guistyle }}/img/misc/save_later.gif"/>
		</td>
	</tr>
</table>

<script type="text/javascript">
	document.observe('dom:loaded', function() {
		$('{{ plugin.id }}_{{ forloop.counter0 }}_run').observe('click', function() {
			var userData = $H(eval('(' + '{{ data.userData }}'.unescapeHTML() + ')'));
			userData.set('ItemId', '{{ plugin.itemPrefix }}{{ data.itemCounter }}');
			{{ plugin.id }}.run('{{ plugin.id }}_{{ forloop.counter0 }}', capitalizeHashKeys(userData));
		});

		$('{{ plugin.id }}_{{ forloop.counter0 }}_save').observe('click', function() {
			var userData = $H(eval('(' + '{{ data.userData }}'.unescapeHTML() + ')'));
			userData.set('ItemId', '{{ plugin.itemPrefix }}{{ data.itemCounter }}');
			{{ plugin.id }}.saveItemForLater('{{ plugin.id }}_{{ forloop.counter0 }}', capitalizeHashKeys(userData));
		});
	});
</script>
