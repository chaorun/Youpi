
{# Sextractor template #}
<script type="text/javascript" src="/media/js/3rdParty/scriptaculous/scriptaculous.js"></script>
<div style="text-align: center;">
	<div id="submenu">
		<div style="margin-right: 10px; margin-top: 10px; text-align: right;">
			<img style="cursor: pointer" src="/media/themes/{{ user.get_profile.guistyle }}/img/misc/add_to_cart.gif" onclick="{{ plugin.id }}.addSelectionToCart();"/>
		</div>
		<div style="margin-left: 30px;" id="menuitem_sub_0">
			<div>
				<b style="text-align:left;">Select the SExtractor processing mode</b>
				<tr>
					<table class="sex_mode">
							<tr>
								<td style="text-align: center;vertical-align:middle;">
									<table>
										<tr><td><input id = "single" type="radio" name="mode" value="single" selected="selected"> Single Image Mode</input></td></tr>
										<tr><td><input id = "dual" type="radio" name="mode" value="dual"> Dual Image Mode</input></td></tr>
									</table>
								</td>
							</tr>
					</table>
				</tr>
			</div>
			<div id="help_mode" class="tip" style="display:none;width:50%"></div></td></tr>
			<div id ="{{plugin.id}}_results_div" style="float:left"></div>
			<div id ="{{plugin.id}}_results_div2" style="float:left"></div>
		</div>
		</div>
		<div align="center" style="display: none; width: 100%" id="menuitem_sub_1">
			<div style="float:left;" id="selector_div"></div>
		</div>

		</div>
		<div align="center" style="display: none; width: 100%" id="menuitem_sub_2">
			<div style="width: 500px" id="config_file_div"></div>
		</div>
		<div align="center" style="display: none; width: 100%" id="menuitem_sub_3"></div>
	</div>
</div>

<script type="text/javascript">
	var text_single = "<b> Single Image Mode Option:</b><li>Creation a catalogue of objects from an astronomic image<br><li>support for WeightMaps<br><li>support for FlagMaps<br>";
	var text_dual = "<b>Dual Image Mode Option:</b><li>Image1 is used for detection of sources, image2 for measurements only.<br><li>Image1 and image2 must have the same dimensions.<br><li>For most photometric parameters,image1 will use image2 pixel values, which allows one to easily measurepixel-to-pixel colours.";
$('single','dual').each(function (id) {
	if (id.value == 'single') {
		id.observe('mouseover', function() {
			$('help_mode').update(text_single);
			$('help_mode').appear();
			});

		id.observe('mouseout', function() {
			$('help_mode').fade();
			});
		}
	else if (id.value == 'dual') { 
		id.observe('mouseover', function() {
			$('help_mode').update(text_dual);
			$('help_mode').appear();
			});
		
		id.observe('mouseout', function() {
			$('help_mode').fade();
			});
		}	
	}
);

	var menu;
	document.observe('dom:loaded', function() {
		menu = new SubMenu('submenu', ['Select images', 'Select data paths', 'Select a configuration file', 'Set output directory']);
		menu.setOnClickHandler(3, function() {
			$('output_path_input').focus();
		});

		{{ plugin.id }}.selectImages();
	});
			

	var cf = new ConfigFileWidget('config_file_div', '{{ plugin.id }}');
	fm_file_browser = new FileBrowser('{{ plugin.id }}_fbw_div', 'fm_file_browser');
	fm_file_browser.setRootTitle('Terapix Cluster');
	fm_file_browser.setFilteringPatterns(['*_flag.fits', '*_weight.fits', '*_psf.fits']);
	fm_file_browser.setRootDataPath('/data');

	// Enable user output custom directory
	plugin_enableOutputDirectory('menuitem_sub_3', '{{ processing_output }}{{ user.username }}/{{ plugin.id }}/');
		
	var selector = new PathSelectorWidget('selector_div', '{{ plugin.id }}');
	selector.addPath('FLAG data', 'flags');
	selector.addPath('WEIGHT data', 'weights');
	selector.addPath('PSF data', 'psf');
	selector.setFileBrowser(fm_file_browser);
	selector.render();

	// Now file browser can renders itself
	fm_file_browser.render();

</script>
